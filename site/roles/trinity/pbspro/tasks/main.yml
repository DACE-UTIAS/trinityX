---
# tasks file for pbspro
- name: Install ohpc-release
  yum:
    name: "{{ openhpc_release_rpm }}"
    state: installed
  when: ansible_facts['os_family'] == "RedHat" and ansible_facts['distribution_major_version']|int < 9

- name: Install Openpbs-server
  yum:
    name: openpbs-server-ohpc
    state: present
  tags: install-only
  when: on_controller|default(True)

- name: Install openpbs-execution-ohpc
  yum:
    name: openpbs-execution-ohpc
    state: present
  tags: install-only
  when: compute|default(False)

- name: Configure PBSPro
  template:
    src: pbs.conf.j2
    dest: /etc/pbs.conf
  notify: restart pbs

- name: Configure mom_priv
  template:
    src: mom_priv_config.j2
    dest: /var/spool/pbs/mom_priv/config
  notify: restart pbs
  when: compute|default(False)

- name: Enable and start PBS
  systemd:
    name: pbs
    enabled: "yes"
    state: started
